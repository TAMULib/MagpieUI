<br/>
<div class="row" ng-controller="AnnotateController">

    <!-- ADMINS, MANAGERS AND ANNOTATORS ONLY -->
    <div ng-if="isUser()" class="row" ng-include src="'views/restrictedAccess.html'" ></div>

    <div ng-if="document.publishedLocations.length > 0" class="panel panel-success">
        <div class="panel-heading">This document is published at URI:</div>
        <div class="panel-body">
            <span ng-repeat="publishedLocation in document.publishedLocations">
              <b>{{publishedLocation.repository.name}}</b>: <a target="_blank" href="{{publishedLocation.url}}">{{publishedLocation.url}}</a>
            </span>
        </div>
    </div>

    <div ng-if="action === 'view' && document.status === 'Accepted'" class="panel panel-warning">
        <div class="panel-heading">This document is accepted but not published.</div>
        <div class="panel-body">
            <button class="btn btn-success" ng-click="push()">Publish</button>
        </div>
    </div>

    <div id="pleaseWaitDialog" class="modal fade centerProgress" role="dialog">
        <img src="resources/images/loading.gif" height="200" width"200"/>
        <div class="loading-text">{{loadingText}}</div>
    </div>

    <div ng-if="!isUser()" class="row">

        <div class="notesWarning bg-warning" ng-if="document.notes">Rejection notes: <span class="notesText">{{document.notes}}</span></div>

        <div class="col-8 col-lg-8 document-pane">
            <div role="tabpanel" class="span6">
                <h2>Document</h2>

                <ul class="nav nav-tabs" role="tablist">
                    <li role="presentation" class="active"><a href="#txtTab" aria-controls="txtTab" role="tab" data-toggle="tab">Text</a></li>
                    <li role="presentation"><a href="#pdfTab" aria-controls="pdfTab" role="tab" data-toggle="tab">PDF</a></li>
                </ul>
                <div class="tab-content">
                    <div role="tabpanel" class="tab-pane active" id="txtTab" ng-if="document.txtUri">
                        <object data="{{document.txtUri}}" type="text/plain" width="100%" height="600"></object>
                    </div>
                    <div role="tabpanel" class="tab-pane" id="pdfTab" ng-if="document.pdfUri">
                        <div class="text-right">
                            <a title="Open PDF in a new window/tab" target="_blank" href="{{document.pdfUri}}"><span class="glyphicon glyphicon-new-window"></span></a>
                        </div>
                        <object id="pdf" data="{{document.pdfUri}}" width="100%" height="600" frameborder="0"></object>
                    </div>
                </div>
            </div>
        </div>

        <div ng-if="action === 'annotate' || action === 'review'">
            <h2>Metadata</h2>
            <form name="metadataForm" novalidate>
                <span ng-show="requiredFieldsPresent()" class="requiredField">required flield</span>
                <div class="col-4 col-lg-4 metadata-pane">
                    <metadatainput ng-repeat="field in document.fields | orderBy:['-label.profile.required', 'label.profile.gloss']" class="row" ng-hide="field.label.profile.hidden"></metadatainput>
                </div>
                <div class="row">
                    <div ng-if="isAnnotator() || (isManager() && managerAnnotating())" style="float: right;">
                        <button type="button" class="btn btn-warning" ng-click="requiresCuration()">Requires Curation</button>
                        <button type="button" class="btn btn-primary" ng-click="save(document)">Save</button>
                        <button type="button" ng-disabled="metadataForm.$invalid" class="btn btn-success" ng-click="submit()">Submit</button>
                    </div>
                    <div ng-if="isAdmin() || (isManager() && managerReviewing())" style="float: right;">
                        <button type="button" class="btn btn-warning" ng-click="requiresCuration()">Requires Curation</button>
                        <button type="button" class="btn btn-primary" ng-click="save()">Save</button>
                        <span ng-if="document.status === 'Annotated'" >
                            <modal modal-id="rejectModal"
                                   modal-view="views/modals/rejectModal.html"
                                   modal-btn-classes="btn btn-danger"
                                   modal-header-class="modal-header-danger">
                                   Reject
                            </modal>
                        </span>
                        <button type="button" ng-disabled="metadataForm.$invalid" class="btn btn-success" ng-click="accept()" >Accept</button>
                    </div>

                </div>
            </form>

        </div>

        <div ng-if="action === 'view'">
            <h2>Metadata</h2>

            <div class="col-4 col-lg-4 metadata-pane">
                <div ng-repeat="field in document.fields | orderBy:['-label.profile.required', 'label.profile.gloss']" class="row">
                    <label>{{field.label.profile.gloss}}</label>

                    <ul class="list-unstyled">
                        <li ng-if="field.label.profile.repeatable" >
                            <ol>
                                <li ng-repeat="fieldValue in field.values">
                                    <span>{{field.values[$index].value}}</span>
                                </li>
                            </ol>
                        </li>
                        <li ng-if="!field.label.profile.repeatable">
                            <div class="tabbed">{{field.values[0].value}}</div>
                        </li>
                    </ul>
                    <hr>
                </div>

            </div>
        </div>
    </div>
</div>
